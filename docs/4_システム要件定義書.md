了解しました。
ここまで整理した内容を踏まえて、**システム要件定義書**と、**MCPのセットアップ＆利用方法ガイド**を一つのパッケージとして作成します。
これでCursorやClaude Codeに渡せば、開発チームがすぐ実装・利用できる状態になります。

---

# 📄 **会計Freee & QuickBooks MCP システム要件定義書**

## 1. システム構成

### 1.1 アーキテクチャ概要

* **MCPサーバー（ローカル動作）**

  * Freee API / QuickBooks APIからデータ取得
  * 勘定科目、取引先、品目、部門、税区分、仕訳データを共通スキーマに整形
  * JSONレスポンスとして上位アプリに返却
* **アプリケーション層**

  * MCPのJSONを受け取り、連結精算表・月次推移表・予実比較・計上ルート別分析を生成
  * Python（pandas）やNode.jsで実装
  * 出力先：Excel / Googleスプレッドシート

---

### 1.2 システム構成図（ローカル前提）

```mermaid
graph TD
  A[Cursor / Claude Code] -->|自然言語指示| B[MCPサーバー (ローカル)]
  B -->|OAuth2認証| C[freee API]
  B -->|OAuth2認証| D[QuickBooks API]
  B -->|共通JSON出力| E[ローカル集計スクリプト]
  E -->|集計結果| F[Excel/Google Sheets/ダッシュボード]
```

---

## 2. 環境要件

| 項目     | 要件                                                |
| ------ | ------------------------------------------------- |
| 実行環境   | macOS / Linux / Windows (Docker推奨)                |
| 言語     | Node.js (MCPサーバー), Python or TypeScript (集計スクリプト) |
| 開発環境   | Cursor + Claude Code + Codex CLI                  |
| 認証     | OAuth2.0 (freee / QuickBooks)                     |
| データ保存  | ローカルキャッシュ（SQLiteなど）、S3へバックアップ可                    |
| セキュリティ | トークンは.envで安全管理、通信はHTTPS                           |

---

## 3. 機能要件（技術的観点）

* **APIクライアント**

  * freee：仕訳、勘定科目、取引先、品目、部門、タグ、税区分
  * QuickBooks：JournalEntry, Account, Vendor, Item, Department
* **スキーマ変換**

  * 借方／貸方統一、通貨換算、取引先・部門名解決
* **出力フォーマット**

  * 共通JSONスキーマ（先に作成した完全スキーマに準拠）
* **認証管理**

  * ローカルにトークン保存、期限切れ時にリフレッシュ

---

## 4. 非機能要件

| 項目     | 要件                       |
| ------ | ------------------------ |
| 性能     | 仕訳10,000件を5分以内で取得・変換     |
| 可用性    | 決算期でも安定稼働、APIレート制限時はリトライ |
| セキュリティ | トークン暗号化、アクセスログ記録         |
| 運用     | 月次決算時はCFOがワンコマンドで再取得可能   |

---

## 5. 運用要件

* データ取得は日次 or CFO指示で手動実行
* 月末決算前に強制再取得
* ログをローカル保存し、監査時に提示可能にする

---

# 🛠 **MCPセットアップ & 利用ガイド**

以下をCursorに渡して実行すれば、開発環境構築が可能です。

---

