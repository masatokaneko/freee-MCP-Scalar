# 実装計画書（2024-03-10 更新）

## 目的
残課題（APIロギング整合性、Excelエクスポートのデータ整合、API仕様ドキュメント整備）を解消し、freee MCP サーバーの品質を向上させる。

## 対応範囲
- Freee API クライアントのロギング関数呼び出し整合性
- Excel エクスポートスクリプトのレスポンス整合性
- OpenAPI および README の仕様同期

## アプローチ（T.Wada 流TDD）
1. **Red**: 期待する振る舞いを表すテストを先に追加し、失敗を確認する。
2. **Green**: 実装を修正してテストを成功させる。
3. **Refactor**: 実装/テストのリファクタリングと共通化を行う。
4. 各イテレーションでコミットポイントまで完結させ、ドキュメント更新を併走させる。

## タスク一覧
1. **APIロギング整合性**
   - `freeeClient` のロギング呼び出しを検証するテストを追加（Red）。
   - `logApiRequest`/`logApiResponse` の引数順序を修正（Green）。
   - ログ周りの重複コードの整理（Refactor）。

2. **Excelエクスポート整合性**
   - `/freee/monthly-trends` など代表エンドポイントのレスポンスに基づくスナップショットテストを作成。
   - `scripts/export_to_excel.js` のマッピング修正。
   - 追加エンドポイント分のマッピングに共通ユーティリティ導入（必要に応じて）。

3. **ドキュメント同期**
   - OpenAPI を `/freee/*`・監査系エンドポイント・`detail` パラメータに合わせて更新。
   - README のルーティングリストと利用例を最新化。
   - 仕様変更履歴に記録。

## 完了条件
- 追加したテストがすべて成功し、既存テストも通過すること。
- Excel 出力スクリプトが主要エンドポイントのデータを正しく取り扱えること（テストで担保）。
- OpenAPI/README が最新実装と一致し、レビューで差分が説明可能な状態であること。

