# 会計Freee MCP 実装計画書

最終更新日: 2025-09-22
作成責任者: プロジェクトチーム（Scalar Labs）

## 1. 現状サマリー
- 仕訳取得、集計、予実管理などコアAPIは安定稼働中。
- OAuth認証・トークン自動更新、監査ログ、キャッシュ層まで導入済み。
- 2025-09-22 時点で、月次PL試算表を自動生成するCLI (`scripts/generate_pl_report.js`) を追加し、データ取得〜レポート化をワンコマンド化した。

## 2. 直近アップデート
| 日付 | 内容 | 影響範囲 | 対応状況 |
|------|------|----------|----------|
| 2025-09-24 | CSVレポートCLIを刷新し、Google Sheets 向けエクスポート・取引先/品目/部門月次推移・勘定科目コード体系を実装。 | 分析オペレーション、ドキュメント | 本番反映済 |
| 2025-09-22 | `scripts/generate_pl_report.js` を新規追加。freee仕訳エクスポートを自動待機し、PL勘定のみ抽出したJSON/Markdownレポートを出力。 | 分析オペレーション、ドキュメント | 本番反映済 |
| 2025-09-22 | README / セットアップ手順を更新し、PL試算表CLIの利用手順を追記。 | ドキュメント | 本番反映済 |
| 2025-09-22 | 旧 `implementation_plan.md` の冗長な記載を整理し、本書に統合。 | ドキュメント | 本番反映済 |

## 3. 今後の優先タスク
| ID | タスク | 詳細 | 優先度 | 目標時期 | 担当 | ステータス |
|----|--------|------|--------|----------|------|-----------|
| R1 | PLレポート分類ルールの明文化 | 勘定科目とPL区分のマッピング表をJSON化し、CLI内ロジックから切り出す。 | 中 | 2025-10 | Data Team | 未着手 |
| R2 | 複数月レポート生成オプション | `--start`/`--end` 指定時に月別シートをまとめて出力する機能を追加。 | 中 | 2025-11 | Backend | 計画中 |
| R3 | スケジューラ連携 | cron/CIからCLIを呼び出し、定期的にレポートを生成＆保管する仕組みを整備。 | 低 | 2025-11 | Ops | 構想中 |

## 4. 技術的負債 / リスク
| 項目 | リスク概要 | 暫定対策 |
|------|------------|----------|
| freee API仕様変更 | 仕訳エクスポートのCSVヘッダ変更でパーサが影響を受ける可能性。 | 公式アナウンス監視とユニットテスト整備。 |
| 勘定科目の分類揺らぎ | カテゴリ情報に依存しているため、新規科目追加時に分類漏れが発生する場合がある。 | マッピングテーブル化と回帰テストの追加。 |
| 大量データ時のポーリング時間 | エクスポート処理が長時間化するケースではCLIの待ち時間が伸びる。 | タイムアウト設定と進捗ログの強化を検討。 |

## 5. 参考資料
- `README.md`：セットアップとAPI概要
- `docs/セットアップ手順書.md`：環境構築〜認証フロー詳細
- `docs/進捗管理表.md`：タスク進捗の定義と履歴
- `docs/仕様変更履歴.md`：リリース履歴

## 6. 次回レビュー予定
- 2025-10 上旬に上記タスク進捗を確認し、優先度を再評価する。
