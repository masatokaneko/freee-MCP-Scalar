# データ運用ガイド（OSS公開向け）

最終更新日: 2025-09-22

## 1. 目的
- 機密データを含まない状態でリポジトリを公開できるよう、分析結果とスクリプトを明確に分離する。
- 誤って秘密情報をコミットしないための運用フローを整理する。

## 2. 出力先の設計
| 種別 | 例 | Git 管理 | 補足 |
|------|----|----------|------|
| スクリプト／ドキュメント | `src/`, `scripts/`, `docs/` | ✅ | OSSに含める |
| 自動生成レポート（既定） | `private_reports/` | ❌ | `.gitignore` 済み。コミットされない（`pl_trial_balance[_partner|_item]_*.csv`, `..._pivot_*.csv`, `account_code_catalog.csv` など） |
| 自動生成レポート（任意パス） | `$HOME/freee-reports/` 等 | ❌ | `FREEE_REPORT_OUTPUT_DIR` または `--output-dir` で指定 |

## 3. 出力先の指定方法
```bash
# 1) 一時的に指定
node scripts/generate_pl_report.js --month=2025-01 --output-dir=$HOME/freee-reports

# 2) 環境変数に固定
export FREEE_REPORT_OUTPUT_DIR=$HOME/freee-reports
node scripts/generate_pl_report.js --month=2025-02

# 3) Google Sheets 用に一括エクスポート
node scripts/export_freee_reports.js --start=2024-12-01 --end=2025-05-31 --reports=all --output-dir=$HOME/freee-reports
```

## 4. 誤ってコミットしてしまった場合
```bash
# Git の追跡から外す
git rm --cached private_reports/*.json

# .gitignore を確認し、再度コミット
```

## 5. 公開リポジトリの運用ルール（推奨）
- 社内分析結果や顧客データは **常に** リポジトリ外のパスに保存する。
- Pull Request では `git status` を確認し、`private_reports/` 以下の差分がないことをチェックする。
- OSS 公開用のブランチでは `.env` や認証情報を含めない（`.env.example` のみ共有）。

## 6. 参考
- README「OSS公開時のデータ運用」
- docs/セットアップ手順書.md「3.3 OSS公開時の注意」
